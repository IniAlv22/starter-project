rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    function validArticle() {
      return request.resource.data.keys().hasOnly([
        'title',
        'subtitle',
        'content',
        'imageUrl',
        'createdAt',
        'updatedAt'
      ])
      &&
      request.resource.data.title is string
        && request.resource.data.title.size() >= 3
      &&
      request.resource.data.content is string
        && request.resource.data.content.size() >= 20
      &&
      (
        !('imageUrl' in request.resource.data)
        || request.resource.data.imageUrl is string
      )
      &&
      request.resource.data.createdAt is timestamp
      &&
      request.resource.data.updatedAt is timestamp;
    }

    match /articles/{id} {

      // Lectura pública
      allow read: if true;

      // Escritura solo si el documento es válido (para la prueba no usamos auth)
      allow create, update: if validArticle();

      // Opcional: permitir borrar solo si el doc existe
      allow delete: if true;
    }
  }
}